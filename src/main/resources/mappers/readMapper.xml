<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.four.mappers.readMapper">

	<select id="selectRead" resultType="com.four.myapp.domain.ReadVO">
		select A.topic_type,
		A.topic_title, A.topic_short_cont, A.topic_no, B.topic_long_cont,
		B.topic_pro, B.topic_con,
		C.debate_endate, C.debate_tot_pro,
		C.debate_tot_con, C.debate_tot_neut,
		(Select user_nick From user_tbl
		where user_no = A.user_no) AS user_nick
		FROM topic_tbl AS A INNER JOIN
		topic_detail_tbl AS B INNER JOIN debate_tbl AS C
		where A.topic_no =
		B.topic_no = C.topic_no = #{topic_no};
	</select>

	<select id="selectResource" resultType="com.four.myapp.domain.ReadResourceVO">
		select
		topic_resource_title, topic_resource_link from topic_resource_tbl
		where topic_no = #{topic_no}
	</select>

	<select id="selectOpinion" resultType="com.four.myapp.domain.ReadOpinionVO">
		select A.op_no,A.op_content,A.op_like,A.op_rel, A.op_regdate,
		A.vote_type,(Select user_nick From user_tbl where user_no = A.user_no) AS user_nick,
		(Select user_lv From user_tbl where user_no = A.user_no) AS user_lv
		 from opinion_tbl AS A where topic_no = #{topic_no};
	</select>

	<insert id="topicvoteinsert">
		insert into vote_tbl (topic_no, user_no, vote_type) values(#{topic_no},
		#{user_no}, #{vote_type})
	</insert>
	
	<update id="votepro">
		update debate_tbl set debate_tot_pro = debate_tot_pro+1
	</update>
	<update id="votecon">
		update debate_tbl set debate_tot_con = debate_tot_con+1
	</update>
	<update id="voteneut">
		update debate_tbl set debate_tot_neut = debate_tot_neut+1
	</update>
	
	<select id="readvote" resultType="com.four.myapp.domain.ReadVO">
		select user_no from vote_tbl where topic_no = #{topic_no} and user_no = #{user_no}
	</select>
	
</mapper>